{"version":3,"file":"site-context-Qsxygl3d.js","sources":["../src/site-context.ts"],"sourcesContent":["/**\n * Shared helpers for resolving monowiki base URLs and current page context.\n * The server injects meta tags so we don't have to guess from the current path.\n */\n\nconst BASE_META = 'monowiki-base-url';\nconst SLUG_META = 'monowiki-note-slug';\n\nfunction readMeta(name: string): string | null {\n  return document.querySelector<HTMLMetaElement>(`meta[name=\"${name}\"]`)?.content ?? null;\n}\n\nfunction normalizeBasePath(raw: string): string {\n  if (!raw) return '/';\n  let path = raw.trim();\n  if (!path.startsWith('/')) {\n    path = `/${path}`;\n  }\n  // Ensure a single trailing slash\n  path = path.replace(/\\/+$/, '/');\n  // Collapse duplicate slashes (except the leading one we forced above)\n  path = path.replace(/\\/{2,}/g, '/');\n  return path || '/';\n}\n\nfunction deriveBasePath(): string {\n  const urlObj = new URL(document.baseURI);\n  const directory = urlObj.pathname.replace(/\\/[^/]*$/, '/');\n  return normalizeBasePath(directory);\n}\n\nconst BASE_PATH = normalizeBasePath(readMeta(BASE_META) ?? deriveBasePath());\nconst BASE_URL = new URL(BASE_PATH, window.location.origin);\n\n/** Absolute base URL for the site (includes origin + base path). */\nexport function getBaseUrl(): string {\n  return BASE_URL.toString();\n}\n\n/** Base path portion (always starts/ends with \"/\"). */\nexport function getBasePath(): string {\n  const path = BASE_URL.pathname;\n  return path.endsWith('/') ? path : `${path}/`;\n}\n\n/** Resolve a path against the monowiki base path (keeps subpaths intact). */\nexport function resolveWithBase(path: string): URL {\n  // Absolute URL passthrough\n  if (/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(path)) {\n    return new URL(path);\n  }\n\n  const clean = path.replace(/^\\/+/, '');\n  const joined = `${getBasePath()}${clean}`;\n  return new URL(joined, window.location.origin);\n}\n\n/** Strip the configured base path from a pathname and drop leading slashes. */\nexport function stripBasePath(pathname: string): string {\n  const basePath = getBasePath();\n  let path = pathname;\n  if (path.startsWith(basePath)) {\n    path = path.slice(basePath.length);\n  }\n  return path.replace(/^\\/+/, '');\n}\n\n/** Best-effort current note slug (uses injected meta when available). */\nexport function currentNoteSlug(): string | null {\n  const metaSlug = readMeta(SLUG_META)?.trim();\n  if (metaSlug) return metaSlug;\n\n  const relativePath = stripBasePath(window.location.pathname);\n  if (!relativePath) return null;\n\n  const withoutIndex = relativePath.endsWith('index.html')\n    ? relativePath.slice(0, -'index.html'.length)\n    : relativePath;\n  const withoutHtml = withoutIndex.endsWith('.html')\n    ? withoutIndex.slice(0, -'.html'.length)\n    : withoutIndex;\n\n  if (!withoutHtml) return null;\n\n  const segments = withoutHtml.split('/').filter(Boolean);\n  return segments.pop() ?? null;\n}\n"],"names":[],"mappings":"AAKA,MAAM,YAAY;AAClB,MAAM,YAAY;AAElB,SAAS,SAAS,MAA6B;AAH/C;AAIE,WAAO,cAAS,cAA+B,cAAc,IAAI,IAAI,MAA9D,mBAAiE,YAAW;AACrF;AAEA,SAAS,kBAAkB,KAAqB;AAC9C,MAAI,CAAC,IAAK,QAAO;AACjB,MAAI,OAAO,IAAI,KAAA;AACf,MAAI,CAAC,KAAK,WAAW,GAAG,GAAG;AACzB,WAAO,IAAI,IAAI;AAAA,EACjB;AAEA,SAAO,KAAK,QAAQ,QAAQ,GAAG;AAE/B,SAAO,KAAK,QAAQ,WAAW,GAAG;AAClC,SAAO,QAAQ;AACjB;AAEA,SAAS,iBAAyB;AAChC,QAAM,SAAS,IAAI,IAAI,SAAS,OAAO;AACvC,QAAM,YAAY,OAAO,SAAS,QAAQ,YAAY,GAAG;AACzD,SAAO,kBAAkB,SAAS;AACpC;AAEA,MAAM,YAAY,kBAAkB,SAAS,SAAS,KAAK,gBAAgB;AAC3E,MAAM,WAAW,IAAI,IAAI,WAAW,OAAO,SAAS,MAAM;AAQnD,SAAS,cAAsB;AACpC,QAAM,OAAO,SAAS;AACtB,SAAO,KAAK,SAAS,GAAG,IAAI,OAAO,GAAG,IAAI;AAC5C;AAGO,SAAS,gBAAgB,MAAmB;AAEjD,MAAI,4BAA4B,KAAK,IAAI,GAAG;AAC1C,WAAO,IAAI,IAAI,IAAI;AAAA,EACrB;AAEA,QAAM,QAAQ,KAAK,QAAQ,QAAQ,EAAE;AACrC,QAAM,SAAS,GAAG,YAAA,CAAa,GAAG,KAAK;AACvC,SAAO,IAAI,IAAI,QAAQ,OAAO,SAAS,MAAM;AAC/C;AAGO,SAAS,cAAc,UAA0B;AACtD,QAAM,WAAW,YAAA;AACjB,MAAI,OAAO;AACX,MAAI,KAAK,WAAW,QAAQ,GAAG;AAC7B,WAAO,KAAK,MAAM,SAAS,MAAM;AAAA,EACnC;AACA,SAAO,KAAK,QAAQ,QAAQ,EAAE;AAChC;AAGO,SAAS,kBAAiC;AA/DjD;AAgEE,QAAM,YAAW,cAAS,SAAS,MAAlB,mBAAqB;AACtC,MAAI,SAAU,QAAO;AAErB,QAAM,eAAe,cAAc,OAAO,SAAS,QAAQ;AAC3D,MAAI,CAAC,aAAc,QAAO;AAE1B,QAAM,eAAe,aAAa,SAAS,YAAY,IACnD,aAAa,MAAM,GAAG,CAAC,aAAa,MAAM,IAC1C;AACJ,QAAM,cAAc,aAAa,SAAS,OAAO,IAC7C,aAAa,MAAM,GAAG,CAAC,QAAQ,MAAM,IACrC;AAEJ,MAAI,CAAC,YAAa,QAAO;AAEzB,QAAM,WAAW,YAAY,MAAM,GAAG,EAAE,OAAO,OAAO;AACtD,SAAO,SAAS,SAAS;AAC3B;"}